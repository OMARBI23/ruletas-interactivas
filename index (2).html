<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruletas de Equipos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a3a3a; /* Dark Teal Background */
        }
        /* La propiedad de transición ahora se establece dinámicamente con JavaScript */
        .roulette-container {
            transform-origin: center center;
        }
        .accent-green {
            color: #00ff99; /* Bright Green Accent */
        }
    </style>
</head>
<body class="text-gray-200">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-white">Sesión Extraordinaria</h1>
            <p class="text-lg accent-green mt-2 font-semibold">Selección de Representantes de Equipo</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Ruleta Equipo 1 -->
            <div id="team-1" class="bg-[#1E3A44] p-6 rounded-2xl shadow-lg flex flex-col items-center">
                <h2 class="text-2xl font-semibold mb-2 text-white text-center">Equipo 1</h2>
                <h3 class="text-md font-medium text-gray-400 mb-4 text-center">Así suena la fibrosis pulmonar</h3>
                <div class="relative w-72 h-72 md:w-80 md:h-80 mb-4">
                    <div id="roulette-container-1" class="roulette-container w-full h-full">
                        <canvas id="roulette-1" width="500" height="500" class="roulette-canvas rounded-full w-full h-full"></canvas>
                    </div>
                    <!-- Puntero estático con SVG -->
                    <svg class="absolute top-[-12px] left-1/2 -translate-x-1/2 w-6 h-4 z-10" fill="#FFD700" viewBox="0 0 10 7"><polygon points="5,7 0,0 10,0"/></svg>
                </div>
                <button onclick="spinRoulette(1)" class="w-full bg-[#00ff99] text-[#1a3a3a] font-bold py-3 px-6 rounded-lg hover:bg-opacity-90 transition duration-300 shadow-md text-lg">
                    Girar Ruleta
                </button>
                <div id="result-1" class="mt-4 text-center h-12 flex items-center justify-center">
                     <p class="text-lg font-semibold accent-green">&nbsp;</p>
                </div>
            </div>

            <!-- Ruleta Equipo 2 -->
            <div id="team-2" class="bg-[#1E3A44] p-6 rounded-2xl shadow-lg flex flex-col items-center">
                <h2 class="text-2xl font-semibold mb-2 text-white text-center">Equipo 2</h2>
                <h3 class="text-md font-medium text-gray-400 mb-4 text-center">Atlas de imágenes de EPI</h3>
                <div class="relative w-72 h-72 md:w-80 md:h-80 mb-4">
                    <div id="roulette-container-2" class="roulette-container w-full h-full">
                         <canvas id="roulette-2" width="500" height="500" class="roulette-canvas rounded-full w-full h-full"></canvas>
                    </div>
                    <!-- Puntero estático con SVG -->
                    <svg class="absolute top-[-12px] left-1/2 -translate-x-1/2 w-6 h-4 z-10" fill="#FFD700" viewBox="0 0 10 7"><polygon points="5,7 0,0 10,0"/></svg>
                </div>
                <button onclick="spinRoulette(2)" class="w-full bg-[#00ff99] text-[#1a3a3a] font-bold py-3 px-6 rounded-lg hover:bg-opacity-90 transition duration-300 shadow-md text-lg">
                    Girar Ruleta
                </button>
                 <div id="result-2" class="mt-4 text-center h-12 flex items-center justify-center">
                     <p class="text-lg font-semibold accent-green">&nbsp;</p>
                </div>
            </div>

            <!-- Ruleta Equipo 3 -->
            <div id="team-3" class="bg-[#1E3A44] p-6 rounded-2xl shadow-lg flex flex-col items-center">
                <h2 class="text-2xl font-semibold mb-2 text-white text-center">Equipo 3</h2>
                <h3 class="text-md font-medium text-gray-400 mb-4 text-center">Infografía de prevalencia y mortalidad EPI-AR</h3>
                 <div class="relative w-72 h-72 md:w-80 md:h-80 mb-4">
                    <div id="roulette-container-3" class="roulette-container w-full h-full">
                         <canvas id="roulette-3" width="500" height="500" class="roulette-canvas rounded-full w-full h-full"></canvas>
                    </div>
                     <!-- Puntero estático con SVG -->
                    <svg class="absolute top-[-12px] left-1/2 -translate-x-1/2 w-6 h-4 z-10" fill="#FFD700" viewBox="0 0 10 7"><polygon points="5,7 0,0 10,0"/></svg>
                </div>
                <button onclick="spinRoulette(3)" class="w-full bg-[#00ff99] text-[#1a3a3a] font-bold py-3 px-6 rounded-lg hover:bg-opacity-90 transition duration-300 shadow-md text-lg">
                    Girar Ruleta
                </button>
                 <div id="result-3" class="mt-4 text-center h-12 flex items-center justify-center">
                    <p class="text-lg font-semibold accent-green">&nbsp;</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        let audioCtx; // Global Audio Context

        // Sound generation functions
        function playTickSound() {
            if (!audioCtx) return;
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.type = 'square';
            oscillator.frequency.setValueAtTime(1200, audioCtx.currentTime);
            gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.05);
        }

        function playWinSound() {
            if (!audioCtx) return;
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
            oscillator.frequency.exponentialRampToValueAtTime(1046.50, audioCtx.currentTime + 0.15); // Rises to C6
            gainNode.gain.setValueAtTime(0.4, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.4);
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.4);
        }

        // Datos de los equipos actualizados
        const teams = {
            1: {
                members: [
                    'Catalina Cynthy Ojeda', 'Eber Abdul González Duarte', 'Manuel Francisco Vázquez Millán',
                    'Yarid Grapain Calderón', 'Marco Antonio Cosme Cruz', 'Mario Nieto'
                ],
                colors: ['#00A6A6', '#F2C12E', '#F28705', '#D95204', '#A62F03', '#7C1C52'],
                currentAngle: 0,
                isSpinning: false,
            },
            2: {
                members: [
                    'Enrique Cervantes Martínez', 'Alma Graciela Aguado', 'Jean Giusseppe Córdoba De Rueda',
                    'Yesenia Carmona Villavicencio', 'Liliana Reza Salazar', 'Ricardo S.'
                ],
                colors: ['#6B4E71', '#3A6EA5', '#A5D8F2', '#F2B807', '#D96704', '#0072BB'],
                 currentAngle: 0,
                isSpinning: false,
            },
            3: {
                members: [
                    'Laura Paulina Delgado Arredondo', 'Gilberto A. Salinas García', 'Oscar Correa', 'Isaac López Cervantes', 'Luis A.'
                ],
                colors: ['#2E86AB', '#A23B72', '#F18F01', '#C73E1D', '#9B59B6'],
                 currentAngle: 0,
                isSpinning: false,
            }
        };

        // Función para dibujar la ruleta
        function drawRoulette(teamId) {
            const team = teams[teamId];
            const canvas = document.getElementById(`roulette-${teamId}`);
            if (!canvas.getContext) return;

            const ctx = canvas.getContext('2d');
            const numSegments = team.members.length;
            const angleStep = (2 * Math.PI) / numSegments;
            const radius = canvas.width / 2;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = '#1E3A44';
            ctx.lineWidth = 4;
            ctx.font = '18px Inter, sans-serif';

            team.members.forEach((member, i) => {
                const angle = i * angleStep;
                ctx.fillStyle = team.colors[i % team.colors.length];

                ctx.beginPath();
                ctx.moveTo(radius, radius);
                ctx.arc(radius, radius, radius - 5, angle - Math.PI / 2, angle + angleStep - Math.PI / 2);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();

                // Dibujar texto
                ctx.save();
                ctx.fillStyle = '#fff';
                ctx.translate(radius, radius);
                ctx.rotate(angle + angleStep / 2 - Math.PI / 2);
                ctx.textAlign = 'right';
                ctx.textBaseline = 'middle';
                
                const nameParts = member.split(' ');
                const displayName = nameParts.length > 1 ? `${nameParts[0]} ${nameParts[1].charAt(0)}.` : nameParts[0];
                ctx.fillText(displayName, radius - 20, 0);
                ctx.restore();
            });
        }

        // Función para girar la ruleta
        function spinRoulette(teamId) {
            const team = teams[teamId];
            if (team.isSpinning) return;
            team.isSpinning = true;

            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }

            const rouletteContainer = document.getElementById(`roulette-container-${teamId}`);
            const resultDiv = document.getElementById(`result-${teamId}`);
            resultDiv.querySelector('p').innerHTML = '&nbsp;';
            
            const randomDuration = 10 + Math.random() * 5; 
            const randomRotations = 10 + Math.random() * 10;
            
            rouletteContainer.style.transition = `transform ${randomDuration}s cubic-bezier(0.1, 0.9, 0.2, 1)`;

            const spinAngle = Math.random() * 360 + 360 * randomRotations;
            const newAngle = team.currentAngle + spinAngle;
            
            rouletteContainer.style.transform = `rotate(${newAngle}deg)`;
            team.currentAngle = newAngle;

            // --- NEW Synchronized Sound Logic ---
            let lastKnownAngle = -1;
            const numSegments = team.members.length;
            const degreesPerSegment = 360 / numSegments;

            function tickLoop() {
                if (!team.isSpinning) {
                    return; // Detiene el bucle cuando termina el giro
                }

                const transformMatrix = window.getComputedStyle(rouletteContainer).transform;
                if (transformMatrix === 'none') {
                    requestAnimationFrame(tickLoop);
                    return;
                }
                const matrixValues = transformMatrix.split('(')[1].split(')')[0].split(',');
                const a = parseFloat(matrixValues[0]);
                const b = parseFloat(matrixValues[1]);
                const currentAngle = Math.round(Math.atan2(b, a) * (180 / Math.PI));
                const normalizedAngle = (currentAngle + 360) % 360;

                if (lastKnownAngle === -1) {
                    lastKnownAngle = normalizedAngle;
                }
                
                const lastSegment = Math.floor(lastKnownAngle / degreesPerSegment);
                const currentSegment = Math.floor(normalizedAngle / degreesPerSegment);

                if (lastSegment !== currentSegment) {
                    playTickSound();
                }

                lastKnownAngle = normalizedAngle;
                requestAnimationFrame(tickLoop);
            }

            requestAnimationFrame(tickLoop); // Inicia el bucle de sonido sincronizado

            // --- End of Spin ---
            setTimeout(() => {
                team.isSpinning = false; // Detiene el bucle de ticks
                playWinSound(); 

                const finalAngle = team.currentAngle % 360;
                const winningAngle = 360 - finalAngle;
                const winnerIndex = Math.floor(winningAngle / degreesPerSegment);
                const winner = team.members[winnerIndex];

                const resultP = resultDiv.querySelector('p');
                resultP.textContent = `¡El representante es: ${winner}!`;
                
                rouletteContainer.style.transition = '';

            }, randomDuration * 1000); 
        }

        window.onload = () => {
            drawRoulette(1);
            drawRoulette(2);
            drawRoulette(3);
        };
    </script>
</body>
</html>

